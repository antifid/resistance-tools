<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Front-Loading Donation Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #fafafa;
    }

    .page {
      display: flex;
      flex-direction: column;
      max-width: 1100px;
      margin: auto;
      padding: 15px;
      gap: 20px;
    }

    h1 {
      font-size: 20px;
      margin: 0 0 10px 0;
    }

    .layout {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .tool {
      flex: 1;
      background: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }

    .instructions {
      flex: 1;
      background: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      font-size: 14px;
      line-height: 1.4;
    }

    .controls {
      margin-bottom: 15px;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 14px;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 10px;
      font-size: 14px;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: center;
    }

    th {
      background: #f2f2f2;
    }

    input.money {
      width: 100px;
      padding: 4px;
      text-align: right;
    }

    .year-col {
      width: 65px;
      font-weight: bold;
    }

    button {
      margin-top: 15px;
      padding: 10px 18px;
      font-size: 15px;
      cursor: pointer;
      border-radius: 8px;
      border: none;
      background: black;
      color: white;
    }

    /* Mobile mode: everything fits neatly */
    @media (max-width: 700px) {
      .layout {
        flex-direction: column;
      }
      .instructions {
        display: none;
      }
      .toggle-instructions { display: inline-block; }
      table {
        font-size: 12px;
      }
      input.money {
        width: 80px;
      }
    }

    .toggle-instructions { 
      margin-bottom: 10px;
      width: 100%;
      padding: 10px;
      font-size: 14px;
      border-radius: 8px;
      border: none;
      background: black;
      color: white;
      cursor: pointer;
    }

    /* Desktop mode: calculator + instructions side by side */
    @media (min-width: 701px) {
      .toggle-instructions {
        display: none;
      }
      .layout {
        flex-direction: row;
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <h1>Front-Loading Donation Calculator</h1>

    <div class="layout">
      <button class="toggle-instructions" id="toggleBtn">Show Instructions</button>
      <div class="tool">
        <div class="controls">
          <label>
            Discount Rate (% per year):
            <input type="number" id="rate" value="5" step="0.1" min="0" />
          </label>

          <br><br>

          <label>
            <input type="radio" name="mode" value="one" checked />
            One year (front-load into 2026)
          </label>
          <br>
          <label>
            <input type="radio" name="mode" value="three" />
            Three years (front-load into 2026–2028)
          </label>

          <br><br>

          <label>
            <input type="checkbox" id="sameAllYears" />
            All years the same (copy values from 2026)
          </label>
        </div>

        <table id="budgetTable">
          <thead>
            <tr>
              <th class="year-col">Year</th>
              <th>Original Planned Amount</th>
              <th>Crisis Planned Amount</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>

        <button id="calcBtn">Calculate</button>
      </div>

      <div class="instructions">
        <h2 style="font-size:16px;margin-top:0;">How to Use This Tool</h2>
        <p>
          This calculator helps you shift (“front-load”) donations into the early crisis years
          while keeping the overall long-term budget fair using Net Present Value (NPV).
        </p>
        <ol>
          <li>Enter your annual discount rate (If you don't know, then 5% is a good default).</li>
          <li>Fill in your Original Planned Amounts.</li>
          <li>Adjust Crisis Planned Amounts for later years if desired.</li>
          <li>If you will want the same values for every year (Original) or future year (Crisis), enter those numbers for 2026, and select "All years the same..."
          <li>Click <b>Calculate</b>. The tool will automatically increase early-year giving
              to balance reductions later.</li>
        </ol>
      </div>
    </div>
  </div>

  <script>
    const startYear = 2026;
    const numYears = 20;
    const tableBody = document.querySelector("#budgetTable tbody");

    function formatMoneyInput(input) {
      let val = parseInt(input.value.replace(/[^0-9]/g, "")) || 0;
      input.value = val.toLocaleString("en-US");
    }

    function getMoneyValue(input) {
      return parseFloat(input.value.replace(/,/g, "")) || 0;
    }

    // Build table rows
    for (let i = 0; i < numYears; i++) {
      const year = startYear + i;
      const row = document.createElement("tr");

      const yearCell = document.createElement("td");
      yearCell.textContent = year;
      yearCell.className = "year-col";

      const opaCell = document.createElement("td");
      const opaInput = document.createElement("input");
      opaInput.type = "text";
      opaInput.className = "money";
      opaInput.value = "0";
      opaInput.id = `opa-${year}`;
      opaInput.addEventListener("blur", () => formatMoneyInput(opaInput));
      opaCell.appendChild(opaInput);

      const npaCell = document.createElement("td");
      const npaInput = document.createElement("input");
      npaInput.type = "text";
      npaInput.className = "money";
      npaInput.value = "0";
      npaInput.id = `npa-${year}`;
      npaInput.addEventListener("blur", () => formatMoneyInput(npaInput));
      npaCell.appendChild(npaInput);

      row.appendChild(yearCell);
      row.appendChild(opaCell);
      row.appendChild(npaCell);

      tableBody.appendChild(row);
    }

    // Handle "All years the same"
    document.getElementById("sameAllYears").addEventListener("change", function () {
      const checked = this.checked;
      const baseOPA = document.getElementById("opa-2026");
      const baseNPA = document.getElementById("npa-2026");

      for (let i = 1; i < numYears; i++) {
        const year = startYear + i;
        const opaField = document.getElementById(`opa-${year}`);
        const npaField = document.getElementById(`npa-${year}`);

        if (checked) {
          opaField.value = baseOPA.value;
          npaField.value = baseNPA.value;
          opaField.disabled = true;
          npaField.disabled = true;
        } else {
          opaField.disabled = false;
          npaField.disabled = false;
        }
      }

      if (checked) {
        baseOPA.addEventListener("input", syncAllYears);
        baseNPA.addEventListener("input", syncAllYears);
      } else {
        baseOPA.removeEventListener("input", syncAllYears);
        baseNPA.removeEventListener("input", syncAllYears);
      }
    });

    function syncAllYears() {
      const baseOPA = document.getElementById("opa-2026").value;
      const baseNPA = document.getElementById("npa-2026").value;

      for (let i = 1; i < numYears; i++) {
        const year = startYear + i;
        document.getElementById(`opa-${year}`).value = baseOPA;
        document.getElementById(`npa-${year}`).value = baseNPA;
      }
    }

    
    // Mobile instructions toggle
    const toggleBtn = document.getElementById("toggleBtn");
    const instructionsPanel = document.querySelector(".instructions");

    toggleBtn.addEventListener("click", function() {
      if (instructionsPanel.style.display === "block") {
        instructionsPanel.style.display = "none";
        toggleBtn.textContent = "Show Instructions";
      } else {
        instructionsPanel.style.display = "block";
        toggleBtn.textContent = "Hide Instructions";
      }
    });

    // Calculation
    document.getElementById("calcBtn").addEventListener("click", function () {
      const rPercent = parseFloat(document.getElementById("rate").value);
      const r = rPercent / 100;
      const mode = document.querySelector("input[name='mode']:checked").value;

      let NPV = 0;

      for (let i = 0; i < numYears; i++) {
        const year = startYear + i;

        const opa = getMoneyValue(document.getElementById(`opa-${year}`));
        const npa = getMoneyValue(document.getElementById(`npa-${year}`));

        const exponent = i + 1;
        const discountFactor = Math.pow(1 + r, exponent);

        let diff = 0;
        if (mode === "one") {
          if (year !== 2026) diff = opa - npa;
        } else {
          if (![2026, 2027, 2028].includes(year)) diff = opa - npa;
        }

        NPV += diff / discountFactor;
      }

      if (mode === "one") {
        const opa2026 = getMoneyValue(document.getElementById("opa-2026"));
        document.getElementById("npa-2026").value =
          Math.round(opa2026 + NPV).toLocaleString("en-US");
      } else {
        for (let year of [2026, 2027, 2028]) {
          const opaVal = getMoneyValue(document.getElementById(`opa-${year}`));
          document.getElementById(`npa-${year}`).value =
            Math.round(opaVal + NPV / 3).toLocaleString("en-US");
        }
      }

      alert("Calculation complete. NPA values updated.");
    });
  </script>
</body>
</html>





