<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Front-Loading Donation Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #fafafa;
    }

    .page {
      display: flex;
      flex-direction: column;
      max-width: 1100px;
      margin: auto;
      padding: 15px;
      gap: 20px;
    }

    h1 {
      font-size: 20px;
      margin: 0 0 10px 0;
    }

    .layout {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .tool {
      flex: 1;
      background: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }

    .instructions {
      flex: 1;
      background: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      font-size: 14px;
      line-height: 1.4;
    }

    .controls {
      margin-bottom: 15px;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 14px;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 10px;
      font-size: 14px;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: center;
    }

    th {
      background: #f2f2f2;
    }

    input.money {
      width: 100px;
      padding: 4px;
      text-align: right;
    }

    .year-col {
      width: 65px;
      font-weight: bold;
    }

    button {
      margin-top: 15px;
      padding: 10px 18px;
      font-size: 15px;
      cursor: pointer;
      border-radius: 8px;
      border: none;
      background: black;
      color: white;
    }

    /* Mobile mode: everything fits neatly */
    @media (max-width: 700px) {
      .layout {
        flex-direction: column;
      }
      .instructions {
        display: none;
      }
      .toggle-instructions { display: inline-block; }
      table {
        font-size: 12px;
      }
      input.money {
        width: 80px;
      }
    }

    .toggle-instructions { 
      margin-bottom: 10px;
      width: 100%;
      padding: 10px;
      font-size: 14px;
      border-radius: 8px;
      border: none;
      background: black;
      color: white;
      cursor: pointer;
    }

    /* Desktop mode: calculator + instructions side by side */
    @media (min-width: 701px) {
      .toggle-instructions {
        display: none;
      }
      .layout {
        flex-direction: row;
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <h1>Front-Loading Donation Calculator</h1>

      <div class="instructions">
        <h2 style="font-size:16px;margin-top:0;">How to Use This Tool</h2>
        <p>
          This calculator helps you shift (“front-load”) donations into the early crisis years
          while keeping the overall long-term budget fair using Net Present Value (NPV). <i>(If you don't know what NPV is, that's OK. The calculator does the math part. You can keep in mind the "fair" part.)</i><br>
		  The idea is that you tell the calculator how much you're willing to reduce your future donations, by giving it donation amounts in your Original plan and your Crisis plan. The calculator will then tell you
		  how much you should give in early years to "fairly" balance those reductions.
        </p>
        <ol>
          <li>Enter your annual discount rate. (If you don't have a guess, use 5%.)</li>
          <li>Decide whether you're front-loading just into 2026, or into 3 years 2026-2028.</li?
          <li>If you will want the same values for every year, check the "Use these values for all years" box and then enter the Original Planned Amount and Crisis Planned Amount once each. Remember that the Crisis Planned Amount should be at least as high as the Original Planned Amount since if there's a crisis in 2027, you won't be increasing dinations in 2035.
          <li>If you want a more customized plan year-by-year, leave that box unchecked and enter the amounts for each year.
          <li>Click <b>Calculate</b>. The tool will automatically set either the first year or the first three years to balance reductions later.</li>
        </ol>
      </div>

    <div class="layout">
      <button class="toggle-instructions" id="toggleBtn">Show Instructions</button>
      <div class="tool">
        <div class="controls">
          <label>
            Discount Rate (% per year):
            <input type="number" id="rate" value="5" step="0.1" min="0" />
          </label>

          <br><br>

          <label>
            <input type="radio" name="mode" value="one" checked />
            One year (front-load into 2026)
          </label>
          <br>
          <label>
            <input type="radio" name="mode" value="three" />
            Three years (front-load into 2026–2028)
          </label>

          <br><br>

          <label>
            <input type="checkbox" id="sameAllYears" />
            Use these values for all years
          </label>
          <br><br>

        <table id="masteTable">
          <thead>
            <tr>
              <th>Original Planned Amount</th>
              <th>Crisis Planned Amount</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <th><input type="text" id="masterOPA" class="money-input" placeholder="0"></th>
              <th><input type="text" id="masterNPA" class="money-input" placeholder="0"></th>
            </tr>
	  </tbody>
        </table>

        </div>

        <table id="budgetTable">
          <thead>
            <tr>
              <th class="year-col">Year</th>
              <th>Original Planned Amount</th>
              <th>Crisis Planned Amount</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>

        <button id="calcBtn">Calculate</button>
      </div>

    </div>
  </div>

  <script>
    const startYear = 2026;
    const numYears = 20;
    const tableBody = document.querySelector("#budgetTable tbody");

    function formatMoneyInput(input) {
      let val = parseInt(input.value.replace(/[^0-9]/g, "")) || 0;
      input.value = val.toLocaleString("en-US");
    }

    function getMoneyValue(input) {
      return parseFloat(input.value.replace(/,/g, "")) || 0;
    }

    // Build table rows
    for (let i = 0; i < numYears; i++) {
      const year = startYear + i;
      const row = document.createElement("tr");

      const yearCell = document.createElement("td");
      yearCell.textContent = year;
      yearCell.className = "year-col";

      const opaCell = document.createElement("td");
      const opaInput = document.createElement("input");
      opaInput.type = "text";
      opaInput.className = "money";
      opaInput.value = "0";
      opaInput.id = `opa-${year}`;
      opaInput.addEventListener("blur", () => formatMoneyInput(opaInput));
      opaCell.appendChild(opaInput);

      const npaCell = document.createElement("td");
      const npaInput = document.createElement("input");
      npaInput.type = "text";
      npaInput.className = "money";
      npaInput.value = "0";
      npaInput.id = `npa-${year}`;
      npaInput.addEventListener("blur", () => formatMoneyInput(npaInput));
      npaCell.appendChild(npaInput);

      row.appendChild(yearCell);
      row.appendChild(opaCell);
      row.appendChild(npaCell);

      tableBody.appendChild(row);
    }

    // Handle "All years the same"
    document.getElementById("sameAllYears").addEventListener("change", function () {
      const checked = this.checked;
      const baseOPA = document.getElementById("masterOPA");
      const baseNPA = document.getElementById("masterNPA");

      for (let i = 0; i < numYears; i++) {
        const year = startYear + i;
        const opaField = document.getElementById(`opa-${year}`);
        const npaField = document.getElementById(`npa-${year}`);

        if (checked) {
          opaField.value = baseOPA.value;
          npaField.value = baseNPA.value;
          opaField.disabled = true;
          npaField.disabled = true;
        } else {
          opaField.disabled = false;
          npaField.disabled = false;
        }
      }

      if (checked) {
        baseOPA.addEventListener("input", syncAllYears);
        baseNPA.addEventListener("input", syncAllYears);
      } else {
        baseOPA.removeEventListener("input", syncAllYears);
        baseNPA.removeEventListener("input", syncAllYears);
      }
    });

    function validateCurrencyField(input, fieldName) {
      const value = getMoneyValue(input);
      if (value < 0) {
        alert(`${fieldName} cannot be negative.`);
        input.value = "0";
        return false;
      }
      return true;
    }

    function validateCrisisVsOriginal(opaField, npaField, year) {
      const opa = getMoneyValue(opaField);
      const npa = getMoneyValue(npaField);

      if (npa > opa) {
        alert(`For ${year}, Crisis Planned Amount cannot be larger than Original Planned Amount.`);
        npaField.value = opa.toLocaleString("en-US");
        return false;
      }
      return true;
    }

    for (let i = 0; i < numYears; i++) {
      const year = startYear + i;
      const opaField = document.getElementById(`opa-${year}`);
      const npaField = document.getElementById(`npa-${year}`);

      opaField.addEventListener("input", () => {
        validateCurrencyField(opaField, `Original Planned Amount (${year})`);
        validateCrisisVsOriginal(opaField, npaField, year);
      });

      npaField.addEventListener("input", () => {
        validateCurrencyField(npaField, `Crisis Planned Amount (${year})`);
        validateCrisisVsOriginal(opaField, npaField, year);
      });
    }

    document.getElementById("masterOPA").addEventListener("input", function() {
      validateCurrencyField(this, "Master Original Planned Amount");
      syncAllYears();
    });

    document.getElementById("masterNPA").addEventListener("input", function() {
      validateCurrencyField(this, "Master Crisis Planned Amount");
      validateCrisisVsOriginal(
        document.getElementById("masterOPA"),
        this,
        "Master Fields"
      );
      syncAllYears();
    });

    function syncAllYears() {
      const baseOPA = document.getElementById("masterOPA").value;
      const baseNPA = document.getElementById("masterNPA").value;

      for (let i = 0; i < numYears; i++) {
        const year = startYear + i;
        document.getElementById(`opa-${year}`).value = baseOPA;
        document.getElementById(`npa-${year}`).value = baseNPA;
      }
    }
    
    // Mobile instructions toggle
    const toggleBtn = document.getElementById("toggleBtn");
    const instructionsPanel = document.querySelector(".instructions");

    toggleBtn.addEventListener("click", function() {
      if (instructionsPanel.style.display === "block") {
        instructionsPanel.style.display = "none";
        toggleBtn.textContent = "Show Instructions";
      } else {
        instructionsPanel.style.display = "block";
        toggleBtn.textContent = "Hide Instructions";
      }
    });

    // Calculation
    document.getElementById("calcBtn").addEventListener("click", function () {
      const rPercent = parseFloat(document.getElementById("rate").value);
      const r = rPercent / 100;
      const mode = document.querySelector("input[name='mode']:checked").value;

      let NPV = 0;

      for (let i = 0; i < numYears; i++) {
        const year = startYear + i;

        const opa = getMoneyValue(document.getElementById(`opa-${year}`));
        const npa = getMoneyValue(document.getElementById(`npa-${year}`));

        const exponent = i + 1;
        const discountFactor = Math.pow(1 + r, exponent);

        let diff = 0;
        if (mode === "one") {
          if (year !== 2026) diff = opa - npa;
        } else {
          if (![2026, 2027, 2028].includes(year)) diff = opa - npa;
        }

        NPV += diff / discountFactor;
      }

      if (mode === "one") {
        const opa2026 = getMoneyValue(document.getElementById("opa-2026"));
        document.getElementById("npa-2026").value =
          Math.round(opa2026 + NPV).toLocaleString("en-US");
      } else {
        for (let year of [2026, 2027, 2028]) {
          const opaVal = getMoneyValue(document.getElementById(`opa-${year}`));
          document.getElementById(`npa-${year}`).value =
            Math.round(opaVal + NPV / 3).toLocaleString("en-US");
        }
      }

      // No alert needed
      // alert("Calculation complete. NPA values updated.");
    });
  </script>
</body>
</html>







