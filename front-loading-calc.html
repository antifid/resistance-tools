<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Front-Loading Donation Calculator</title>

<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 0;
  background: #fafafa;
}

.page {
  max-width: 1100px;
  margin: auto;
  padding: 15px;
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.tool, .instructions {
  background: white;
  padding: 15px;
  border-radius: 10px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
}

h1 { margin: 0 0 10px 0; }

input.money {
  width: 140px;
  padding: 6px;
  text-align: right;
}

button {
  margin-top: 12px;
  padding: 10px 18px;
  font-size: 15px;
  cursor: pointer;
  border-radius: 8px;
  border: none;
  background: black;
  color: white;
}

table {
  border-collapse: collapse;
  width: 100%;
  margin-top: 10px;
}

th, td {
  border: 1px solid #ccc;
  padding: 6px;
  text-align: center;
}

th { background: #f2f2f2; }

.advanced {
  margin-top: 15px;
  border-top: 1px solid #ccc;
  padding-top: 15px;
  display: none;
}

.year-col { font-weight: bold; width: 70px; }

.toggle-advanced {
  background: #333;
}

.result-box {
  margin-top: 15px;
  padding: 14px;
  border-radius: 10px;
  background: #f6f8ff;
  border: 1px solid #cdd6ff;
  font-size: 16px;
  line-height: 1.4;
}

.highlight {
  font-weight: bold;
  background: #ffe066;
  padding: 2px 6px;
  border-radius: 4px;
}
</style>
</head>

<body>

<div class="page">

<h1>Front-Loading Donation Calculator</h1>

<div class="instructions">

<h2 style="font-size:16px;margin-top:0;">Purpose of This Tool</h2>

<p>
This calculator helps you calculate the appropriate front-loaded donations for the early crisis years
while keeping your long-term plan financially fair using <a href=https://www.investopedia.com/terms/p/presentvalue.asp target="_blank" rel="noopener noreferrer">present value</a>. You do not need to understand the math â€” the tool handles it.<br></p>
<p>
For a reminder about front-loading, you can review pages 18-20 in the <a href="https://drive.google.com/file/d/1ZN-5vYMGirHE4wUSWhBBiVj90zpcgUi7/view?usp=drive_link" target="_blank" rel="noopener noreferrer">presentation slides</a>.
</p>

<h2 style="font-size:16px;margin-top:0;">How to Use This Tool</h2>

<ol>
  <li>Enter the <b>Original Planned Amount:</b> Your normal yearly donation.</li>
  <li>Enter the <b>Post-Crisis Planned Amount:</b> The reduced yearly donation you would be willing to make later in order to give more in the crisis years.</li>
  <li>Click <b>Calculate</b>. The calculator will tell you how much you should donate in the crisis years.</li>
  <li>(Optional) Open <b>Advanced Options</b> to change assumptions or customize year-by-year.</li>
</ol>
  This tool is new. Find a bug? Email me at <a href="mailto:resistancepocketbook@gmail.com">resistancepocketbook@gmail.com</a> and let me know!
</div>

<div class="tool">

<h3>Basic Plan</h3>

<table id=baseAmounts>
<thead><tr><th colspan="2">Planned Donation Amounts per Year</th></tr></thead>
<tr>
<td><label>
Original Planned Amount:
<input type="text" id="basicOPA" class="money" value="0">
</label></td>

<td><label>
Post-Crisis Planned Amount:
<input type="text" id="basicNPA" class="money" value="0">
</label></td>
</tr></table>

<div class="result-box" id="resultBox" style="display:none;"></div>
<br>
<button class="toggle-advanced" id="toggleAdvanced">
Show Advanced Options
</button>
<button id="calcBtn">Calculate</button>

<div class="advanced" id="advancedPanel">

<h3>Advanced Options</h3>

<label>
<i><b>Special Case:</b>A Discount Rate of 0% will give a dollar-to-dollar shift in donations from later years to early years. This is simplest. However, it will be "unfair" to the donor because they will be effectively donating more value.)</i><br><br>
Discount Rate (% per year):
<input type="number" id="rate" value="5" step="0.1" min="0">
</label>

<br><br>

<label>
<input type="radio" name="mode" value="one">
1-year crisis
</label>

<label>
<input type="radio" name="mode" value="three" checked>
3-year crisis
</label>

<table id="budgetTable">
<thead>
<tr>
<th class="year-col">Year</th>
<th>Original Planned Amount</th>
<th>Post-Crisis Planned Amount</th>
</tr>
</thead>
<tbody></tbody>
</table>

</div>
</div>
</div>

<script defer>
document.addEventListener("DOMContentLoaded", function () {

const startYear = 2026;
const numYears = 20;
const tableBody = document.querySelector("#budgetTable tbody");

function resetAllInputs() {
  // Reset discount rate
  document.getElementById("rate").value = "5";

  // Clear basic plan
  document.getElementById("basicOPA").value = "";
  document.getElementById("basicNPA").value = "";

  // Reset advanced flags
  advancedOPAEdited = false;
  advancedNPAEdited = false;

  // Clear advanced yearly table
  for (let i = 0; i < numYears; i++) {
    const year = startYear + i;
    document.getElementById(`opa-${year}`).value = "";
    document.getElementById(`npa-${year}`).value = "";
  }

  // Optional: clear any result message
  const resultBox = document.getElementById("resultMessage");
  if (resultBox) resultBox.textContent = "";
}

function formatMoney(n) {
  return Math.round(n).toLocaleString("en-US");
}

function formatMoneyInput(input) {
  let val = parseInt(input.value.replace(/[^0-9]/g, "")) || 0;
  input.value = val.toLocaleString("en-US");
}

function getMoneyValue(input) {
  return parseFloat(input.value.replace(/,/g, "")) || 0;
}

let advancedOPAEdited = false;
let advancedNPAEdited = false;

// Build table
for (let i = 0; i < numYears; i++) {
  const year = startYear + i;
  const row = document.createElement("tr");

  const y = document.createElement("td");
  y.textContent = year;
  y.className = "year-col";

  const opa = document.createElement("td");
  const opaInput = document.createElement("input");
  opaInput.className = "money";
  opaInput.value = "0";
  opaInput.id = `opa-${year}`;
  opaInput.addEventListener("blur", () => formatMoneyInput(opaInput));
  opaInput.addEventListener("input", () => {
    advancedOPAEdited = true;
    document.getElementById("basicOPA").value = "";
  });

  opa.appendChild(opaInput);

  const npa = document.createElement("td");
  const npaInput = document.createElement("input");
  npaInput.className = "money";
  npaInput.value = "0";
  npaInput.id = `npa-${year}`;
  npaInput.addEventListener("blur", () => formatMoneyInput(npaInput));
  npaInput.addEventListener("input", () => {
    advancedNPAEdited = true;
    document.getElementById("basicNPA").value = "";
  });
  npa.appendChild(npaInput);

  row.appendChild(y);
  row.appendChild(opa);
  row.appendChild(npa);
  tableBody.appendChild(row);
}

// Advanced toggle
const toggleBtn = document.getElementById("toggleAdvanced");
const adv = document.getElementById("advancedPanel");

toggleBtn.onclick = () => {
  adv.style.display = adv.style.display === "block" ? "none" : "block";
  toggleBtn.textContent =
    adv.style.display === "block"
      ? "Hide Advanced Options"
      : "Show Advanced Options";
};

// Sync basic inputs to table
function syncBasicToTable() {
  const opa = document.getElementById("basicOPA").value;
  const npa = document.getElementById("basicNPA").value;

  for (let i = 0; i < numYears; i++) {
    const year = startYear + i;

    if (!advancedOPAEdited) {
      document.getElementById(`opa-${year}`).value = opa;
    }

    if (!advancedNPAEdited) {
      document.getElementById(`npa-${year}`).value = npa;
    }
  }
}

document.getElementById("basicOPA").addEventListener("input", () => {
  advancedOPAEdited = false;
  advancedNPAEdited = false;
  syncBasicToTable();
});

document.getElementById("basicNPA").addEventListener("input", () => {
  advancedOPAEdited = false;
  advancedNPAEdited = false;
  syncBasicToTable();
});

// Calculation
document.getElementById("calcBtn").onclick = () => {

  syncBasicToTable();

  let r = parseFloat(document.getElementById("rate").value);
  r = isNaN(r) ? 0.05 : r / 100;

  const mode =
    document.querySelector("input[name='mode']:checked").value;

  let PV0 = 0;
  let PV1 = 0;
  let PV3 = 0;
  let v = 1/(1+r);
  
  for (let i = 0; i < numYears; i++) {
    const year = startYear + i;

    const opa = getMoneyValue(document.getElementById(`opa-${year}`));
    const npa = getMoneyValue(document.getElementById(`npa-${year}`));

    PV0 += opa/Math.pow(1+r,1+i);
    if (year !== 2026) PV1 += npa*Math.pow(v,1+i);
    if (![2026, 2027, 2028].includes(year)) PV3 += npa*Math.pow(v,1+i);
  }

  const resultBox = document.getElementById("resultBox");
  let crisisAmount;

  if (mode === "one") {
    crisisAmount = (PV0-PV1)*(1+r);
    document.getElementById("npa-2026").value = formatMoney(crisisAmount);

    resultBox.innerHTML =
      `You should be donating <span class="highlight">$${formatMoney(crisisAmount)}</span>
       in the crisis year <b>2026</b>.`;
//=(B33-F32)/(C1*(1+C1+C1^2))
  } else {
    crisisAmount = (PV0 - PV3) / (v + Math.pow(v,2) + Math.pow(v,3))
    for (let y of [2026, 2027, 2028]) {
      document.getElementById(`npa-${y}`).value =
        formatMoney(crisisAmount);
    }

    const finalAmount =
      getMoneyValue(document.getElementById("npa-2026"));

    resultBox.innerHTML =
      `You should be donating
       <span class="highlight">$${formatMoney(finalAmount)}</span>
       in each crisis year <b>2026, 2027, and 2028</b>.`;
  }

  resultBox.style.display = "block";
};

  document.querySelectorAll("input[name='mode']").forEach(radio => {
    radio.addEventListener("change", resetAllInputs);
  });
                                                  
});
</script>

</body>
</html>






















